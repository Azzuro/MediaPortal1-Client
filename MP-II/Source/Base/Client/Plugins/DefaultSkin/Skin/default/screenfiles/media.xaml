<?xml version="1.0" encoding="utf-8"?>
<Include
    xmlns="www.team-mediaportal.com/2008/mpf/directx"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Source="screenfiles\master_menu.xaml"
    >
  <Include.Resources>

    <!-- Header -->
    <ResourceWrapper x:Key="Header_Text" Resource="[media.name]"/>

    <!-- DataContext -->
    <Model x:Key="Model" RegistrationLocation="Media" Id="Model"/>

    <!-- Menu -->
    <ResourceWrapper x:Key="Menu_Items">
      <Binding Source="{StaticResource Model}" Path="MainMenu" Mode="OneTime"/>
    </ResourceWrapper>

    <!-- Menu command -->
    <!-- Access the (Core type) command from the current menu ListItem, which is
         accessible via the data context -->
    <CommandBridge x:Key="Menu_Command"
        Command="{Binding Path=Command,Mode=OneTime}"
        CommandParameter="{Binding Path=CommandParameter,Mode=OneTime}"/>

    <!-- Contents -->
    <ResourceWrapper x:Key="Contents_Element">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>
        <Label Grid.Row="0" Grid.Column="0"
            DataContext="{Binding Source={StaticResource Model},Path=CurrentView}"
            Content="{Binding DisplayName}"/>
        <!-- Binding Content to NavigatableParentItem[Name] doesn't work here, because the BindingMarkupExtension
             doesn't bind to each path segment, and NavigatableParentItem is null in the first view -->
        <Button Grid.Row="0" Grid.Column="1" Height="40" Width="60"
            Style="{StaticResource ButtonStyle}"
            DataContext="{Binding Source={StaticResource Model}}"
            Content=".."
            Command="{Command Path=Select,Parameters={LateBoundValue Value={Binding NavigatableParentItem}}}"
            IsVisible="{Binding Path=HasParentDirectory}"/>
<!-- Another solution for displaying the ".." button as a list item:
        <ContentControl Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2"
            Style="{StaticResource DefaultMenuItemContainerStyle}"
            DataContext="{Binding Source={StaticResource Model}}"
            Content="{Binding Source={StaticResource Model},Path=NavigatableParentItem}"
            ContentTemplate="{StaticResource ContentsMenuItemDataTemplate}"
            IsVisible="{Binding HasParentDirectory}">
          <ContentControl.Resources>
            <Command x:Key="Menu_Command" Source="{StaticResource Model}" Path="Select"
                Parameters="{LateBoundValue Value={Binding NavigatableParentItem}}"/>
          </ContentControl.Resources>
        </ContentControl>
-->
        <ListView Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
            Style="{StaticResource ContentsMenuListViewStyle}"
            DataContext="{Binding Source={StaticResource Model}}"
            ItemsSource="{Binding Items}">
          <ListView.Resources>
            <Command x:Key="Menu_Command" Source="{StaticResource Model}" Path="Select"
                Parameters="{LateBoundValue Value={Binding}}"/>
          </ListView.Resources>
        </ListView>
      </Grid>
    </ResourceWrapper>

  </Include.Resources>
</Include>
